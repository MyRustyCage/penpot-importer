penpot.ui.open("Website Importer","",{width:400,height:500});penpot.ui.onMessage(t=>{if(t.type==="import-website"){const i=t.data;if(!i)return;try{g(i),penpot.ui.sendMessage({type:"import-success"})}catch(r){penpot.ui.sendMessage({type:"import-error",error:r instanceof Error?r.message:"Unknown error"})}}});function p(t){return!!(t.text&&t.text.trim().length>0||t.styles.backgroundColor!=="rgba(0, 0, 0, 0)"||t.styles.backgroundImage!=="none"||t.styles.boxShadow!=="none"||t.styles.borderRadius!=="0px"&&parseInt(t.styles.borderRadius)>0||["img","svg","button","a","input","textarea","video"].includes(t.tag)||t.src)}function u(t){var o;const i=[];function r(s){s&&(p(s)&&i.push(s),s.children&&s.children.forEach(e=>r(e)))}return r(t.structure.nav),r(t.structure.header),r(t.structure.main),(o=t.structure.sections)==null||o.forEach(s=>r(s)),r(t.structure.footer),i}function a(t){const i=t.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*[\d.]+)?\)/);if(i){const o=parseInt(i[1]).toString(16).padStart(2,"0"),s=parseInt(i[2]).toString(16).padStart(2,"0"),e=parseInt(i[3]).toString(16).padStart(2,"0");return`#${o}${s}${e}`}const r=t.match(/rgb\((\d+),\s*(\d+),\s*(\d+)\)/);if(r){const o=parseInt(r[1]).toString(16).padStart(2,"0"),s=parseInt(r[2]).toString(16).padStart(2,"0"),e=parseInt(r[3]).toString(16).padStart(2,"0");return`#${o}${s}${e}`}return t}function f(t,i){if(t.text&&t.text.trim().length>0){const o=penpot.createText(t.text);if(o){o.x=t.geometry.x,o.y=t.geometry.y,o.resize(t.geometry.width,t.geometry.height);const s=parseInt(t.styles.fontSize);isNaN(s)||(o.fontSize=s.toString());const e=t.styles.fontFamily.split(",")[0].replace(/["']/g,"").trim();e&&(o.fontFamily=e),t.styles.fontWeight&&(o.fontWeight=t.styles.fontWeight);const n=a(t.styles.color);o.fills=[{fillColor:n,fillOpacity:1}],i.appendChild(o)}return}const r=penpot.createRectangle();if(r){if(r.x=t.geometry.x,r.y=t.geometry.y,r.resize(t.geometry.width,t.geometry.height),r.name=t.tag||"Shape",t.styles.backgroundColor&&t.styles.backgroundColor!=="rgba(0, 0, 0, 0)"){const o=a(t.styles.backgroundColor),s=parseFloat(t.styles.opacity)||1;r.fills=[{fillColor:o,fillOpacity:s}]}if(t.styles.borderRadius&&t.styles.borderRadius!=="0px"){const o=parseInt(t.styles.borderRadius);!isNaN(o)&&o>0&&(r.borderRadius=o)}i.appendChild(r)}}function g(t){if(!penpot.currentPage)throw new Error("No active page found");const r=penpot.createBoard();if(!r)throw new Error("Failed to create board");r.name=t.metadata.title||"Imported Website",r.resize(t.metadata.viewport.width,t.metadata.viewport.height),r.x=0,r.y=0;const o=u(t),s=50;for(let e=0;e<o.length;e+=s)o.slice(e,e+s).forEach(c=>f(c,r));penpot.selection=[r]}
