penpot.ui.open("Website Importer","./penpot-importer/",{width:400,height:500});penpot.ui.onMessage(t=>{if(t.type==="import-website"){const n=t.data;if(!n)return;try{T(n),penpot.ui.sendMessage({type:"import-success"})}catch(s){penpot.ui.sendMessage({type:"import-error",error:s instanceof Error?s.message:"Unknown error"})}}});function C(t){return!!(t.text&&t.text.trim().length>0||t.styles.backgroundColor!=="rgba(0, 0, 0, 0)"||t.styles.backgroundImage!=="none"||t.styles.boxShadow!=="none"||t.styles.borderRadius!=="0px"&&parseInt(t.styles.borderRadius)>0||["img","svg","button","a","input","textarea","video"].includes(t.tag)||t.src)}function z(t){var r;const n=[];function s(o){o&&(C(o)&&n.push(o),o.children&&o.children.forEach(e=>s(e)))}return s(t.structure.nav),s(t.structure.header),s(t.structure.main),(r=t.structure.sections)==null||r.forEach(o=>s(o)),s(t.structure.footer),n}function E(t){let n=0,s=0;return t.forEach(r=>{const o=r.geometry.x+r.geometry.width,e=r.geometry.y+r.geometry.height;o>n&&(n=o),e>s&&(s=e)}),{width:Math.max(n,1920),height:Math.max(s,1080)}}function y(t){const n=t.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*[\d.]+)?\)/);if(n){const r=parseInt(n[1]).toString(16).padStart(2,"0"),o=parseInt(n[2]).toString(16).padStart(2,"0"),e=parseInt(n[3]).toString(16).padStart(2,"0");return`#${r}${o}${e}`}const s=t.match(/rgb\((\d+),\s*(\d+),\s*(\d+)\)/);if(s){const r=parseInt(s[1]).toString(16).padStart(2,"0"),o=parseInt(s[2]).toString(16).padStart(2,"0"),e=parseInt(s[3]).toString(16).padStart(2,"0");return`#${r}${o}${e}`}return t}function W(t){const n=t.match(/linear-gradient\(([^)]+)\)/);if(n){const r=n[1];let o=180;const e=r.match(/(\d+)deg/);e?o=parseInt(e[1]):r.includes("to right")?o=90:r.includes("to left")?o=270:r.includes("to top")?o=0:r.includes("to bottom")&&(o=180);const f=/(rgba?\([^)]+\)|hsla?\([^)]+\)|#[0-9a-fA-F]{3,8})(\s+\d+%|\s+\d+px)?/g,i=[];let a;for(;(a=f.exec(r))!==null;){const g=a[1],d=a[2];i.push({color:y(g),position:d?d.trim():null})}if(i.length<2)return null;const l=i.map((g,d)=>{let p;if(g.position){const I=g.position.match(/(\d+)%/);I?p=parseInt(I[1])/100:p=d/(i.length-1)}else p=d/(i.length-1);return{color:g.color,offset:Math.max(0,Math.min(1,p)),opacity:1}}),c=(o-90)*(Math.PI/180),u=.5,b=.5,h=.5,F=u+Math.cos(c)*h,S=b+Math.sin(c)*h,M=u-Math.cos(c)*h,w=b-Math.sin(c)*h;return{type:"linear",startX:M,startY:w,endX:F,endY:S,width:1,stops:l}}const s=t.match(/radial-gradient\(([^)]+)\)/);if(s){const r=s[1],o=/(rgba?\([^)]+\)|hsla?\([^)]+\)|#[0-9a-fA-F]{3,8})(\s+\d+%|\s+\d+px)?/g,e=[];let f;for(;(f=o.exec(r))!==null;){const a=f[1],l=f[2];e.push({color:y(a),position:l?l.trim():null})}return e.length<2?null:{type:"radial",startX:.5,startY:.5,endX:1,endY:.5,width:1,stops:e.map((a,l)=>{let c;if(a.position){const u=a.position.match(/(\d+)%/);u?c=parseInt(u[1])/100:c=l/(e.length-1)}else c=l/(e.length-1);return{color:a.color,offset:Math.max(0,Math.min(1,c)),opacity:1}})}}return null}function k(t){const n=t.split(",")[0].replace(/["']/g,"").trim();if(n.startsWith("__")||n.includes("_")){const s=n.match(/__([A-Za-z]+)_/);return s?s[1]:"Work Sans"}return n||"Work Sans"}function m(t){const n=parseInt(t);return n<=400?"400":n>=700?"700":"400"}function x(t){if(t.id&&t.id.trim().length>0)return t.id;if(t.text&&t.text.length>0&&t.text.length<30)return`${t.tag}: ${t.text.substring(0,20)}`;if(t.class&&typeof t.class=="string"&&t.class.length>0)try{const n=t.class.split(" ")[0];return`${t.tag}.${n}`}catch{return t.tag}return t.tag}function $(t){const n=t.styles.zIndex&&t.styles.zIndex!=="auto"?parseInt(t.styles.zIndex):0;if(t.tag==="svg"){const r=penpot.createRectangle();if(r)return r.x=t.geometry.x,r.y=t.geometry.y,r.resize(t.geometry.width,t.geometry.height),r.name=`${x(t)} [SVG]`,r.fills=[{fillColor:"#FFD700",fillOpacity:.3}],console.log("Created SVG placeholder:",t.id),{element:r,isText:!1,zIndex:n}}if(t.text&&t.text.trim().length>0){const r=penpot.createText(t.text);if(r){r.x=t.geometry.x,r.y=t.geometry.y,r.resize(t.geometry.width,t.geometry.height),r.name=x(t);const o=parseInt(t.styles.fontSize);!isNaN(o)&&o>0&&(r.fontSize=o.toString());try{r.fontFamily=k(t.styles.fontFamily)}catch{r.fontFamily="Work Sans"}if(t.styles.fontWeight)try{r.fontWeight=m(t.styles.fontWeight)}catch{r.fontWeight="400"}try{const e=y(t.styles.color);e&&e!=="rgba(0, 0, 0, 0)"?r.fills=[{fillColor:e,fillOpacity:1}]:r.fills=[{fillColor:"#FFFFFF",fillOpacity:1}]}catch{r.fills=[{fillColor:"#FFFFFF",fillOpacity:1}]}return{element:r,isText:!0,zIndex:n}}return null}const s=penpot.createRectangle();if(s){if(s.x=t.geometry.x,s.y=t.geometry.y,s.resize(t.geometry.width,t.geometry.height),s.name=x(t),t.styles.backgroundImage&&(t.styles.backgroundImage.includes("gradient")||t.styles.backgroundImage.includes("-gradient"))){console.log("Found gradient element:",t.id),console.log("Background image:",t.styles.backgroundImage);const r=W(t.styles.backgroundImage);if(r){console.log("Parsed gradient:",r);try{return s.fills=[{fillColorGradient:r}],console.log("✓ Gradient applied successfully"),{element:s,isText:!1,zIndex:n}}catch(o){console.error("✗ Gradient fill failed:",o)}}else console.warn("Failed to parse gradient")}if(t.styles.backgroundColor&&t.styles.backgroundColor!=="rgba(0, 0, 0, 0)"){const r=y(t.styles.backgroundColor),o=parseFloat(t.styles.opacity)||1;s.fills=[{fillColor:r,fillOpacity:o}]}if(t.styles.borderRadius&&t.styles.borderRadius!=="0px"){const r=parseInt(t.styles.borderRadius);!isNaN(r)&&r>0&&(s.borderRadius=r)}return{element:s,isText:!1,zIndex:n}}return null}function T(t){if(!penpot.currentPage)throw new Error("No active page found");const s=z(t),r=E(s),o=penpot.createBoard();if(!o)throw new Error("Failed to create board");o.name=t.metadata.title||"Imported Website",o.resize(r.width,r.height),o.x=0,o.y=0;const e=[],f=50;for(let i=0;i<s.length;i+=f)s.slice(i,i+f).forEach(l=>{const c=$(l);c&&e.push(c)});e.sort((i,a)=>i.isText!==a.isText?i.isText?1:-1:i.zIndex-a.zIndex),e.forEach(i=>o.appendChild(i.element)),penpot.selection=[o]}
