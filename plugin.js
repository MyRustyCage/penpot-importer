penpot.ui.open("Website Importer","https://myrustycage.github.io/penpot-importer/",{width:400,height:500});penpot.ui.onMessage(t=>{if(t.type==="import-website"){const o=t.data;if(!o)return;try{S(o),penpot.ui.sendMessage({type:"import-success"})}catch(s){penpot.ui.sendMessage({type:"import-error",error:s instanceof Error?s.message:"Unknown error"})}}});function d(t){return!!(t.text&&t.text.trim().length>0||t.styles.backgroundColor!=="rgba(0, 0, 0, 0)"||t.styles.backgroundImage!=="none"||t.styles.boxShadow!=="none"||t.styles.borderRadius!=="0px"&&parseInt(t.styles.borderRadius)>0||["img","svg","button","a","input","textarea","video"].includes(t.tag)||t.src)}function h(t){var r;const o=[];function s(i){i&&(d(i)&&o.push(i),i.children&&i.children.forEach(n=>s(n)))}return s(t.structure.nav),s(t.structure.header),s(t.structure.main),(r=t.structure.sections)==null||r.forEach(i=>s(i)),s(t.structure.footer),o}function y(t){let o=0,s=0;return t.forEach(r=>{const i=r.geometry.x+r.geometry.width,n=r.geometry.y+r.geometry.height;i>o&&(o=i),n>s&&(s=n)}),{width:Math.max(o,1920),height:Math.max(s,1080)}}function f(t){const o=t.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*[\d.]+)?\)/);if(o){const r=parseInt(o[1]).toString(16).padStart(2,"0"),i=parseInt(o[2]).toString(16).padStart(2,"0"),n=parseInt(o[3]).toString(16).padStart(2,"0");return`#${r}${i}${n}`}const s=t.match(/rgb\((\d+),\s*(\d+),\s*(\d+)\)/);if(s){const r=parseInt(s[1]).toString(16).padStart(2,"0"),i=parseInt(s[2]).toString(16).padStart(2,"0"),n=parseInt(s[3]).toString(16).padStart(2,"0");return`#${r}${i}${n}`}return t}function l(t){const o=t.split(",")[0].replace(/["']/g,"").trim();if(o.startsWith("__")||o.includes("_")){const s=o.match(/__([A-Za-z]+)_/);return s?s[1]:"Work Sans"}return o||"Work Sans"}function x(t){const o=parseInt(t);return o<=400?"400":o>=700?"700":"400"}function g(t){if(t.id&&t.id.trim().length>0)return t.id;if(t.text&&t.text.length>0&&t.text.length<30)return`${t.tag}: ${t.text.substring(0,20)}`;if(t.class&&typeof t.class=="string"&&t.class.length>0)try{const o=t.class.split(" ")[0];return`${t.tag}.${o}`}catch{return t.tag}return t.tag}function b(t){const o=t.styles.zIndex&&t.styles.zIndex!=="auto"?parseInt(t.styles.zIndex):0;if(t.text&&t.text.trim().length>0){const r=penpot.createText(t.text);if(r){r.x=t.geometry.x,r.y=t.geometry.y,r.resize(t.geometry.width,t.geometry.height),r.name=g(t);const i=parseInt(t.styles.fontSize);!isNaN(i)&&i>0&&(r.fontSize=i.toString());try{const n=l(t.styles.fontFamily);r.fontFamily=n}catch{r.fontFamily="Work Sans"}if(t.styles.fontWeight)try{r.fontWeight=x(t.styles.fontWeight)}catch{r.fontWeight="400"}try{const n=f(t.styles.color);n&&n!=="rgba(0, 0, 0, 0)"&&n!=="#000000"?r.fills=[{fillColor:n,fillOpacity:1}]:r.fills=[{fillColor:"#FFFFFF",fillOpacity:1}]}catch{r.fills=[{fillColor:"#FFFFFF",fillOpacity:1}]}return{element:r,isText:!0,zIndex:o}}return null}const s=penpot.createRectangle();if(s){if(s.x=t.geometry.x,s.y=t.geometry.y,s.resize(t.geometry.width,t.geometry.height),s.name=g(t),t.styles.backgroundColor&&t.styles.backgroundColor!=="rgba(0, 0, 0, 0)"){const r=f(t.styles.backgroundColor),i=parseFloat(t.styles.opacity)||1;s.fills=[{fillColor:r,fillOpacity:i}]}if(t.styles.borderRadius&&t.styles.borderRadius!=="0px"){const r=parseInt(t.styles.borderRadius);!isNaN(r)&&r>0&&(s.borderRadius=r)}return{element:s,isText:!1,zIndex:o}}return null}function S(t){if(!penpot.currentPage)throw new Error("No active page found");const s=h(t),r=y(s),i=penpot.createBoard();if(!i)throw new Error("Failed to create board");i.name=t.metadata.title||"Imported Website",i.resize(r.width,r.height),i.x=0,i.y=0;const n=[],c=50;for(let a=0;a<s.length;a+=c)s.slice(a,a+c).forEach(p=>{const u=b(p);u&&n.push(u)});n.sort((a,e)=>a.isText!==e.isText?a.isText?1:-1:a.zIndex-e.zIndex),n.forEach(a=>i.appendChild(a.element)),penpot.selection=[i]}
