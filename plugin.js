penpot.ui.open("Website Importer","https://myrustycage.github.io/penpot-importer/",{width:400,height:500});penpot.ui.onMessage(t=>{if(t.type==="import-website"){const o=t.data;if(!o)return;try{x(o),penpot.ui.sendMessage({type:"import-success"})}catch(r){penpot.ui.sendMessage({type:"import-error",error:r instanceof Error?r.message:"Unknown error"})}}});function h(t){return!!(t.text&&t.text.trim().length>0||t.styles.backgroundColor!=="rgba(0, 0, 0, 0)"||t.styles.backgroundImage!=="none"||t.styles.boxShadow!=="none"||t.styles.borderRadius!=="0px"&&parseInt(t.styles.borderRadius)>0||["img","svg","button","a","input","textarea","video"].includes(t.tag)||t.src)}function l(t){var s;const o=[];function r(i){i&&(h(i)&&o.push(i),i.children&&i.children.forEach(n=>r(n)))}return r(t.structure.nav),r(t.structure.header),r(t.structure.main),(s=t.structure.sections)==null||s.forEach(i=>r(i)),r(t.structure.footer),o}function u(t){const o=t.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*[\d.]+)?\)/);if(o){const s=parseInt(o[1]).toString(16).padStart(2,"0"),i=parseInt(o[2]).toString(16).padStart(2,"0"),n=parseInt(o[3]).toString(16).padStart(2,"0");return`#${s}${i}${n}`}const r=t.match(/rgb\((\d+),\s*(\d+),\s*(\d+)\)/);if(r){const s=parseInt(r[1]).toString(16).padStart(2,"0"),i=parseInt(r[2]).toString(16).padStart(2,"0"),n=parseInt(r[3]).toString(16).padStart(2,"0");return`#${s}${i}${n}`}return t}function d(t){const o=t.split(",")[0].replace(/["']/g,"").trim();if(o.startsWith("__")||o.includes("_")){const r=o.match(/__([A-Za-z]+)_/);return r?r[1]:"Work Sans"}return o||"Work Sans"}function y(t){const o=parseInt(t);return o<=400?"400":o>=700?"700":"400"}function f(t,o){if(t.text&&t.text.length>0&&t.text.length<30)return t.text.substring(0,25);if(t.class&&t.class.length>0)try{const r=t.class.split(" ")[0];return`${t.tag}.${r}`}catch{return`${t.tag}-${o}`}return`${t.tag}-${o}`}function b(t,o){if(t.text&&t.text.trim().length>0){const s=penpot.createText(t.text);if(s){s.x=t.geometry.x,s.y=t.geometry.y,s.resize(t.geometry.width,t.geometry.height),s.name=f(t,o);const i=parseInt(t.styles.fontSize);!isNaN(i)&&i>0&&(s.fontSize=i.toString());try{const n=d(t.styles.fontFamily);s.fontFamily=n}catch{s.fontFamily="Work Sans"}if(t.styles.fontWeight)try{s.fontWeight=y(t.styles.fontWeight)}catch{s.fontWeight="400"}try{const n=u(t.styles.color);n&&n!=="rgba(0, 0, 0, 0)"?s.fills=[{fillColor:n,fillOpacity:1}]:s.fills=[{fillColor:"#000000",fillOpacity:1}]}catch{s.fills=[{fillColor:"#000000",fillOpacity:1}]}return{element:s,isText:!0}}return null}const r=penpot.createRectangle();if(r){if(r.x=t.geometry.x,r.y=t.geometry.y,r.resize(t.geometry.width,t.geometry.height),r.name=f(t,o),t.styles.backgroundColor&&t.styles.backgroundColor!=="rgba(0, 0, 0, 0)"){const s=u(t.styles.backgroundColor),i=parseFloat(t.styles.opacity)||1;r.fills=[{fillColor:s,fillOpacity:i}]}if(t.styles.borderRadius&&t.styles.borderRadius!=="0px"){const s=parseInt(t.styles.borderRadius);!isNaN(s)&&s>0&&(r.borderRadius=s)}return{element:r,isText:!1}}return null}function x(t){if(!penpot.currentPage)throw new Error("No active page found");const r=penpot.createBoard();if(!r)throw new Error("Failed to create board");r.name=t.metadata.title||"Imported Website",r.resize(t.metadata.viewport.width,t.metadata.viewport.height),r.x=0,r.y=0;const s=l(t),i=[],n=[],c=50;for(let e=0;e<s.length;e+=c)s.slice(e,e+c).forEach((p,g)=>{const a=b(p,e+g);a&&(a.isText?n.push(a.element):i.push(a.element))});i.forEach(e=>r.appendChild(e)),n.forEach(e=>r.appendChild(e)),penpot.selection=[r]}
